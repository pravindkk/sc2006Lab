<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: UserComponent.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: UserComponent.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import AsyncStorage from '@react-native-async-storage/async-storage';
import { firebase } from '../config'

/**
 * @typedef { Object } User The User stored by the UserComponent.
 * @property { string } uid The UUID of the logged-in User.
 * @property { string } photoURL The URL of the photo of the User. 
 * @property { string } firstName The first name of the User. 
 * @property { string } lastName The last name of the User. 
 * @property { UserSettings } settings Settings of this User?
 */

/**
 * @typedef { Object } UserSettings The settings of a User.
 * @property { boolean } allowNotifications Does this user want to receive notifications?
 */

/**
 * Async void function that stores data locally for the logged-in User, and thereby determines which User is currently logged-in, if any.
 * @param { UserComponentUser } value The currently logged-in User to store. 
 * @return { Promise&lt;void> }
 */
export const StoreUser = async (value) => {
    try {
      const jsonValue = JSON.stringify(value)
      await AsyncStorage.setItem('@user', jsonValue)
    } catch (e) {
      alert(e)
    }
  }

/**
 * Async function that gets the stored User from local storage.
 * @return { User } The data corresponding to a User, stored using StoreUser. 
 */
  export const GetUser = async () => {
    try {
      const jsonValue = await AsyncStorage.getItem('@user')
      // console.log(JSON.parse(jsonValue))
      return jsonValue != null ? JSON.parse(jsonValue) : '';
    } catch(e) {
      alert(e)
    }
  }

  /**
   * Get a User's settings from local storage
   * @param { UserComponentUser } user The User to get the settings for.
   * @returns { UserSettings } The settings for the User.
   */
  export const getSettingsForUser = (user) => {
    return user.settings != undefined ?
      user.settings : { allowNotifications: true };
  }

    /**
   * Async void method to set the current User's settings in both local storage and in cloud storage (Firebase).
   * @param { string } uid The UUID of the current User.
   * @param { UserSettings } settings The settings to set for the current User.
   * @returns { Promise&lt;void> }
   */
  export const setSettingsForUser = async (uid, settings) => {
    const user = await GetUser();
    user.settings = settings;
    await firebase.firestore().collection('users')
      .doc(uid)
      .set(user);
    updateLocalStorage(uid);
  }

  /**
   * Async void function to synchronise the local stored data of the logged-in User with that stored in the cloud DB (firebase).
   * @param { string } uid The UID of the current logged-in User.
   * @returns { Promise&lt;void> }
   */
  export const updateLocalStorage = async (uid) => {
    await firebase.firestore().collection('users').doc(uid).get()
    .then(async (snapshot) => {
      if (snapshot.exists) {
        
        loggedInUser = snapshot.data()
        loggedInUser['uid'] = uid;
        
        StoreUser(loggedInUser)
        console.log("login :" + loggedInUser.photoURL)
      }
      else {
        console.log("error app cannot find user")
      }
    })
    
    
  }
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-pickChatImage.html">pickChatImage</a></li><li><a href="module-pickImage.html">pickImage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#GetUser">GetUser</a></li><li><a href="global.html#LikeGymPage">LikeGymPage</a></li><li><a href="global.html#StoreUser">StoreUser</a></li><li><a href="global.html#getSettingsForUser">getSettingsForUser</a></li><li><a href="global.html#setSettingsForUser">setSettingsForUser</a></li><li><a href="global.html#updateLocalStorage">updateLocalStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sun Nov 13 2022 12:36:01 GMT+0800 (Singapore Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
